angular.module("myApp",["ui.router","textAngular","ngMaterial","underscore","firebase"]).constant("CONFIG",{DebugMode:true,StepCounter:0,APIHost:"http://localhost:12017"});angular.module("myApp").run(["_","$rootScope","$state","Authorization",function(a,b,c,d){b.$on("$stateChangeSuccess",function(b,e,f,g,h){if(!d.authorized()){if(d.memorizedState&&(!a.has(g,"data.redirectTo")||e.name!==g.data.redirectTo)){d.clear()}if(a.has(e,"data")&&a.has(e.data,"authorization")&&a.has(e.data,"redirectTo")){if(a.has(e.data,"memory")&&e.data.memory){d.memorizedState=e.name}c.go(e.data.redirectTo)}}});b.logout=function(){d.clear();c.go("home")};var e={apiKey:"AIzaSyAebzYs_DR29-HYxS0T368XAwg2Tdrvyck",authDomain:"santex-e3078.firebaseapp.com",databaseURL:"https://santex-e3078.firebaseio.com",storageBucket:"santex-e3078.appspot.com"};firebase.initializeApp(e)}]);angular.module("myApp").config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){b.when("","/");b.otherwise("/404");a.state("home",{url:"/",templateUrl:"app/components/home/views/home.view.html"}).state("404",{url:"/404",templateUrl:"app/shared/404.html"}).state("login",{url:"/login",templateUrl:"app/components/login/views/login.view.html",controller:"loginController",controllerAs:"ctrl"}).state("price",{url:"/price",templateUrl:"app/components/price/views/price.view.html",controller:"priceController",controllerAs:"ctrl"}).state("articles",{url:"/articles",templateUrl:"app/components/post/views/articles.view.html",controller:"articlesController",controllerAs:"ctrl"}).state("post",{url:"/post/:postId",templateUrl:"app/components/post/views/post.view.html",controller:"postController",controllerAs:"ctrl"}).state("administration",{url:"/administration",templateUrl:"app/components/administration/views/administration.view.html",controller:"administrationController",controllerAs:"ctrl",data:{authorization:true,redirectTo:"login"}}).state("feedback",{url:"/feedback",templateUrl:"app/components/feedback/views/feedback.view.html",controller:"feedbackController",controllerAs:"ctrl"}).state("gallery",{url:"/gallery",templateUrl:"app/components/gallery/views/gallery.view.html",controller:"galleryController",controllerAs:"ctrl"}).state("works",{url:"/works/{workTitle}",templateUrl:"app/components/worktypes/views/worktypes.view.html",controller:"workTypesController",controllerAs:"ctrl"})}]);(function(){"use strict";angular.module("myApp").controller("administrationController",["articleService","aboutService","homeService","priceService","requestService","$mdDialog","$mdMedia","$rootScope",function(a,b,c,d,e,f,g,h){var i=this;i.tabs=[{title:"Заявки",templateUrl:"app/components/administration/views/requests.administration.view.html"},{title:"Главная",templateUrl:"app/components/administration/views/main.administration.view.html"},{title:"О компании",templateUrl:"app/components/administration/views/about.administration.view.html"},{title:"Статьи",templateUrl:"app/components/administration/views/articles.administration.view.html"},{title:"Прайс лист",templateUrl:"app/components/administration/views/price.administration.view.html"}];i.selectedTab=i.tabs[0];i.selectedTab.active=true;i.selectTab=function(a){i.selectedTab.active=false;i.selectedTab=a;i.selectedTab.active=true};i.mainInfo=c.getInfo();i.saveMainInfo=function(a){var b=f.confirm().title("Сохранить изменения?").targetEvent(a).ok("Сохранить").cancel("Отменить");f.show(b).then(function(){c.saveInfo(i.mainInfo)},function(){})};i.postList=a.preparedData;i.editPostDialog=function(a,b){var c=g("sm")||g("xs");f.show({templateUrl:"app/components/administration/views/newpost.administration.modal.html",parent:angular.element(document.body),targetEvent:a,clickOutsideToClose:false,fullscreen:c,controller:"editPostController as ctrl",locals:{post:b}}).then(function(a){},function(){})};i.deletePost=function(b,c){var d=f.confirm().title("Вы действительно хотите удалить?").textContent("Потом уже ничего не вернуть..").ariaLabel("Lucky day").targetEvent(b).ok("Удалить").cancel("Я еще подумаю");f.show(d).then(function(){a.deletePost(c)},function(){})};i.priceList=d.cardItems;i.savePriceItem=function(a){if(a){d.saveItem(a)}};i.requestList=e.requestList;i.deleteRequest=e.deleteRequest;i.aboutText=b.aboutText;i.saveAboutText=function(){var a=f.confirm().title("Сохранить изменения?").textContent("Сохранение").ariaLabel("Lucky day").targetEvent(event).ok("Сохранить").cancel("Отменить");f.show(a).then(function(){b.saveAboutText(i.aboutText)},function(){})};i.logOut=function(){var a=f.confirm().title("Вы действительно хотите выйти?").textContent("выход из системы").ariaLabel("Lucky day").targetEvent(event).ok("Выйти").cancel("Остаться");f.show(a).then(function(){h.logout()},function(){})};return i}])})();(function(){"use strict";angular.module("myApp").controller("editPostController",["articleService","$mdDialog","$mdMedia","post",function(a,b,c,d){var e=this;e.post=d;e.hide=function(){b.hide()};e.cancel=function(){b.cancel()};e.savePost=function(){a.savePost(e.post);b.cancel()};return e}])})();(function(){"use strict";angular.module("myApp").controller("feedbackController",["feedbackService","$mdDialog","$mdMedia",a]);function a(a,b,c){var d=this;d.feedbackList=a.feedbackList;d.addFeedback=function(a){var d=c("sm")||c("xs");b.show({templateUrl:"app/components/feedback/views/newfeedback.modal.html",parent:angular.element(document.body),targetEvent:a,clickOutsideToClose:true,fullscreen:d,controller:function(a,b){var c=this;c.newFeedback=new Object;c.hide=function(){b.hide()};c.cancel=function(){b.cancel()};c.saveFeedback=function(){if(c.newFeedback){a.saveFeedback(c.newFeedback)}};return c}}).then(function(a){},function(){})};return d}})();(function(){"use strict";angular.module("myApp").factory("feedbackService",function(){var a=this;a.feedbackList=[{id:1,date:Date.today(),name:"Имя",rating:5,text:"feedbackText"}];function b(a){if(a){}}return{saveFeedback:b,feedbackList:a.feedbackList}})})();(function(){"use strict";angular.module("myApp").controller("galleryController",["galleryService",a]);function a(a){var b=this;b.items=a.getData();$(".gallery-container").magnificPopup({delegate:"a",type:"image",gallery:{enabled:true,arrowMarkup:"",tCounter:'<span class="mfp-counter">%curr% из %total%</span>'}});return b}})();(function(){"use strict";var a="galleryService";angular.module("myApp").factory(a,["$filter","$firebaseArray",function b(a,c){var d=this;d.photoList=[];function e(){var a=firebase.database().ref().child("PhotoList");d.photoList=c(a);return d.photoList}function f(b){if(b){if(!d.photoList||d.photoList.length){e()}var c=a("filter")(d.photoList,{workTypeId:b},true)}return c}return{getData:e,getPhotoListByWorkTypeId:f}}])})();(function(){"use strict";angular.module("myApp").controller("homeController",["homeService",a]);function a(a){var b=this;b.info=a.getInfo();return b}})();(function(){"use strict";angular.module("myApp").service("homeService",[function a(){var a=this;function b(){console.log("Get main info");return{phone:"+7(123)456-78-90",address:"Москва, Цветной бульвар д.11 стр.6, офис 406",schedule:"Пн-Вс с 9:00 до 21:00"}}function c(a){}return{getInfo:b,saveInfo:c}}])})();(function(){"use strict";angular.module("myApp").controller("loginController",["$state","Authorization",a]);function a(a,b){var c=this;c.userName="";c.password="";c.messageText="";c.login=function(){if(c.userName=="admin"&&c.password=="admin"){b.go("administration")}else{c.messageText="Неправильный логин или пароль!"}};return c}})();(function(){"use strict";angular.module("myApp").controller("articlesController",["articleService",a]).directive("articlesPreview",b);function a(a){var b=this;b.postList=a.getArticles();return b}function b(){return{restrict:"E",templateUrl:"app/components/post/views/articles-preview.view.html"}}})();(function(){"use strict";var a="articleService";angular.module("myApp").factory(a,["$filter","$firebaseArray",function b(a,c){var d=this;var e={year:"numeric",month:"long",day:"numeric",weekday:"long"};d.preparedData=[];function f(){var a=firebase.database().ref().child("Articles");d.preparedData=c(a);d.preparedData.every(g);return d.preparedData}function g(a,b,c){a.formattedDate=a.date.toLocaleDateString("ru",e);return true}function h(b){if(!d.preparedData||!d.preparedData.length){f()}var c=parseInt(b);if(c){var e=a("filter")(d.preparedData,{id:c},true)}return e}function i(a){if(a){var b=h(a.id);if(!b){a.date=Date.today();console.log(a.date);a.formattedDate=a.date.toLocaleDateString("ru",e);d.preparedData.push(a)}else{b.title=a.title;b.previewText=a.previewText;b.text=a.text;b.date=a.date}}}function j(a){var b=h(a);if(b){var c=d.preparedData.map(function(a){return a.id}).indexOf(a);if(c>-1){d.preparedData.splice(c,1)}}}return{getArticles:f,getPost:h,savePost:i,deletePost:j}}])})();(function(){"use strict";angular.module("myApp").controller("postController",["articleService","$state","$stateParams",a]);function a(a,b,c){var d=this;var e=a.getPost(c.postId);if(e&&e.length){d.post=e[0]}else{b.go("404")}return d}})();(function(){"use strict";angular.module("myApp").controller("priceController",["priceService","workTypesService",a]);function a(a,b){var c=this;var d=a.getData();c.priceGroups=_.groupBy(d,function(a){return a.workTypeId});for(var e in c.priceGroups){var f=parseInt(e);var g=b.getTypeById(f)[0];if(g){c.priceGroups[e].title=g.titleText;c.priceGroups[e].notesText=g.notesText}}return c}})();(function(){"use strict";var a="priceService";angular.module("myApp").factory(a,["$filter","$firebaseArray",function b(a,c){var d=this;d.priceItems=[];function e(){var a=firebase.database().ref().child("PriceItems");d.priceItems=c(a);return d.priceItems}function f(b){if(b){if(!d.priceItems||!d.priceItems.length){e()}var c=a("filter")(d.priceItems,{workTypeId:b},true)}return c}return{getData:e,getPriceItemsByWorkTypeId:f}}])})();(function(){"use strict";angular.module("myApp").controller("requestController",a);function a(){var a=this;return a}})();(function(){"use strict";var a="requestService";angular.module("myApp").factory(a,["$filter",function b(a){var b=this;b.requestList=[{id:1,title:"Заявка 1",date:Date.today(),phone:"+375222242424",email:"email@mail.com",text:"Комментарии к заявке"},{id:2,title:"Заявка 2",date:Date.today(),phone:"+375222242424",email:"email@mail.com",text:"Комментарии к заявке"},{id:3,title:"Заявка 3",date:Date.today(),phone:"+375222242424",email:"email@mail.com",text:"Комментарии к заявке"},{id:4,title:"Заявка 4",date:Date.today(),phone:"+375222242424",email:"email@mail.com",text:"Комментарии к заявке"}];function c(a){if(a){b.requestList.push(a)}}function d(a){}return{requestList:b.requestList,saveRequest:c,deleteRequest:d}}])})();(function(){"use strict";angular.module("myApp").controller("workTypesController",["workTypesService","$state","$stateParams","$filter",a]).directive("svgImage",[b]);function a(a,b,c,d){var e=this;e.workTypes=a.getData();e.selectItem=function(a){if(e.selectedItem){e.selectedItem.active=false}e.selectedItem=a;e.selectedItem.active=true};if(c.workTitle){var f=d("filter")(e.workTypes,{urlText:c.workTitle},true)[0];if(f){e.selectItem(f)}}else{e.selectItem(e.workTypes[0])}$(".gallery-photos").magnificPopup({delegate:"a",type:"image",gallery:{enabled:true,arrowMarkup:"",tCounter:'<span class="mfp-counter">%curr% из %total%</span>'}});return e}function b(){return{restrict:"E",link:function(a,b){var c=b.attr("src");var d=$http.get(c,{"Content-Type":"application/xml"});a.manipulateImgNode=function(a,b){var c=angular.element(a)[4];var d=b.attr("class");if(typeof d!=="undefined"){var e=d.split(" ");for(var f=0;f<e.length;++f){c.classList.add(e[f])}}c.removeAttribute("xmlns:a");return c};d.success(function(c){b.replaceWith(a.manipulateImgNode(c,b))})}}}})();(function(){"use strict";var a="workTypesService";angular.module("myApp").factory(a,["_","priceService","galleryService","$filter","$firebaseArray",function b(a,c,d,e,f){var g=this;g.data=[];function h(){if(!g.data||!g.data.length){var b=firebase.database().ref().child("WorkTypes");g.data=f(b)}a.map(g.data,function(a){if(a){if(a.id){a.priceItems=c.getPriceItemsByWorkTypeId(a.id);a.photos=d.getPhotoListByWorkTypeId(a.id)}}});return g.data}function i(a){if(a){if(!g.data||!g.data.length){h()}var b=e("filter")(g.data,{id:a},true)}return b}return{getData:h,getTypeById:i}}])})();(function(){"use strict";angular.module("myApp").factory("Authorization",["$state",function(a){var b=this;function c(){return localStorage.authorizationToken==="password"}function d(){localStorage.authorizationToken=null}function e(b){localStorage.authorizationToken="password";a.go(b)}return{authorized:c,clear:d,go:e}}])})();$(document).ready(function(){$("a.on-top").click(function(a){$("html, body").animate({scrollTop:0},200);a.preventDefault()});$("a.bktop").click(function(a){$("html, body").animate({scrollTop:0},"1000");a.preventDefault()});$(window).scroll(function(){if($(this).scrollTop()>100){$(".bktop").fadeIn("2000")}else{$(".bktop").fadeOut("500")}})}).on("click",".navbar-collapse.in",function(a){if($(a.target).is("a")){$(this).collapse("hide")}});