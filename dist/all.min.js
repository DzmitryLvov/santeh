angular.module("myApp",["ui.router","textAngular","ngMaterial","underscore","firebase"]).config(["$mdIconProvider",function(a){a.fontSet("md","material-icons")}]).constant("CONFIG",{DebugMode:true,StepCounter:0,APIHost:"http://localhost:12017"});angular.module("myApp").run(["_","$rootScope","$state","Authorization",function(a,b,c,d){b.$on("$stateChangeSuccess",function(b,e,f,g,h){if(!d.authorized()){if(d.memorizedState&&(!a.has(g,"data.redirectTo")||e.name!==g.data.redirectTo)){d.clear()}if(a.has(e,"data")&&a.has(e.data,"authorization")&&a.has(e.data,"redirectTo")){if(a.has(e.data,"memory")&&e.data.memory){d.memorizedState=e.name}c.go(e.data.redirectTo)}}});b.logout=function(){d.clear();c.go("home")};var e={apiKey:"AIzaSyAebzYs_DR29-HYxS0T368XAwg2Tdrvyck",authDomain:"santex-e3078.firebaseapp.com",databaseURL:"https://santex-e3078.firebaseio.com",storageBucket:"santex-e3078.appspot.com"};firebase.initializeApp(e)}]);angular.module("myApp").config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){b.when("","/");b.otherwise("/404");a.state("home",{url:"/",templateUrl:"app/components/home/views/home.view.html"}).state("404",{url:"/404",templateUrl:"app/shared/404.html"}).state("login",{url:"/login",templateUrl:"app/components/login/views/login.view.html",controller:"loginController",controllerAs:"ctrl"}).state("price",{url:"/price",templateUrl:"app/components/price/views/price.view.html",controller:"priceController",controllerAs:"ctrl"}).state("articles",{url:"/articles",templateUrl:"app/components/post/views/articles.view.html",controller:"articlesController",controllerAs:"ctrl"}).state("post",{url:"/post/:postId",templateUrl:"app/components/post/views/post.view.html",controller:"postController",controllerAs:"ctrl"}).state("administration",{url:"/administration",templateUrl:"app/components/administration/administration.view.html",controller:"administrationController",controllerAs:"ctrl",data:{authorization:true,redirectTo:"login"}}).state("administration.price",{url:"/price",templateUrl:"app/components/administration/priceitems/price.administration.view.html",controller:"priceItemAdministrationController",controllerAs:"ctrl",data:{authorization:true,redirectTo:"login"}}).state("administration.works",{url:"/works",templateUrl:"app/components/administration/worktypes/worktypes.administration.view.html",controller:"worktypesAdministrationController",controllerAs:"ctrl",data:{authorization:true,redirectTo:"login"}}).state("administration.photo",{url:"/photos",templateUrl:"app/components/administration/gallery/gallery.administration.view.html",controller:"galleryAdministrationController",controllerAs:"ctrl",data:{authorization:true,redirectTo:"login"}}).state("feedback",{url:"/feedback",templateUrl:"app/components/feedback/views/feedback.view.html",controller:"feedbackController",controllerAs:"ctrl"}).state("gallery",{url:"/gallery",templateUrl:"app/components/gallery/views/gallery.view.html",controller:"galleryController",controllerAs:"ctrl"}).state("works",{url:"/works/{workTitle}",templateUrl:"app/components/worktypes/views/worktypes.view.html",controller:"workTypesController",controllerAs:"ctrl"}).state("houseWorks",{url:"/house/{workTitle}",templateUrl:"app/components/worktypes/views/house.worktypes.view.html",controller:"workTypesHouseController",controllerAs:"ctrl"})}]);(function(){"use strict";angular.module("myApp").controller("administrationController",["articleService","homeService","priceService","requestService","workTypesService","$mdDialog","$mdMedia","$rootScope",a]);function a(a,b,c,d,e,f,g,h){var i=this;i.mainInfo=b.getInfo();i.saveMainInfo=function(a){var c=f.confirm().title("Сохранить изменения?").targetEvent(a).ok("Сохранить").cancel("Отменить");f.show(c).then(function(){b.saveInfo(i.mainInfo)},function(){})};i.postList=a.preparedData;i.editPostDialog=function(a,b){var c=g("sm")||g("xs");f.show({templateUrl:"app/components/administration/views/newpost.administration.modal.html",parent:angular.element(document.body),targetEvent:a,clickOutsideToClose:false,fullscreen:c,controller:"editPostController as ctrl",locals:{post:b}}).then(function(a){},function(){})};i.deletePost=function(b,c){var d=f.confirm().title("Вы действительно хотите удалить?").textContent("Потом уже ничего не вернуть..").ariaLabel("Lucky day").targetEvent(b).ok("Удалить").cancel("Я еще подумаю");f.show(d).then(function(){a.deletePost(c)},function(){})};i.requestList=d.requestList;i.deleteRequest=d.deleteRequest;i.saveAboutText=function(){var a=f.confirm().title("Сохранить изменения?").textContent("Сохранение").ariaLabel("Lucky day").targetEvent(event).ok("Сохранить").cancel("Отменить");f.show(a).then(function(){aboutService.saveAboutText(i.aboutText)},function(){})};i.logOut=function(){var a=f.confirm().title("Вы действительно хотите выйти?").textContent("выход из системы").ariaLabel("Lucky day").targetEvent(event).ok("Выйти").cancel("Остаться");f.show(a).then(function(){h.logout()},function(){})};return i}})();(function(){"use strict";angular.module("myApp").controller("galleryAdministrationController",["galleryService","workTypesService","$mdDialog","$mdMedia",a]);function a(a,c,d,e){var f=this;var g=function(){a.getDataAsync().then(function(a){if(a){f.gallery=a}})};f.editPhotoDialog=function(f,h){var i=e("sm")||e("xs");d.show({templateUrl:"app/components/administration/gallery/photo.administration.modal.html",parent:angular.element(document.body),targetEvent:f,clickOutsideToClose:false,fullscreen:i,controller:b,controllerAs:"ctrl",locals:{$mdDialog:d,galleryService:a,workTypesService:c,photoItem:h}}).then(function(a){g()},function(){})};f.deletePhoto=function(b,c){var e=d.confirm().title("Вы действительно хотите удалить?").textContent("Удаление фото").ariaLabel("delete").targetEvent(b).ok("Удалить").cancel("Отменить");d.show(e).then(function(){a.deleteItem(c).then(function(a){g()})},function(){})};g();return f}function b(a,b,c,d){var e=this;e.photoItem=d;var f=function(){c.getDataAsync().then(function(a){e.workTypes=a})};e.hide=function(){a.hide()};e.cancel=function(){a.cancel()};e.saveItem=function(){b.saveItem(e.photoItem).then(function(b){a.hide()})};e.checkInageUrl=function(a){var b=/(https?:\/\/.*\.(?:png|jpg))/i;return b.test(a)};f();return e}})();(function(){"use strict";angular.module("myApp").controller("editPostController",["articleService","$mdDialog","$mdMedia","post",function(a,b,c,d){var e=this;e.post=d;e.hide=function(){b.hide()};e.cancel=function(){b.cancel()};e.savePost=function(){a.savePost(e.post);b.cancel()};return e}])})();(function(){"use strict";angular.module("myApp").controller("priceItemAdministrationController",["priceService","workTypesService","$mdDialog","$mdMedia",a]);function a(a,c,d,e){var f=this;var g=function(){a.getDataAsync().then(function(a){f.priceGroups=_.groupBy(a,function(a){return a.workTypeId});for(var b in f.priceGroups){if(b=="-1"){f.priceGroups[b].title="Прочие услуги"}else{c.getTypeById(b).then(function(a){if(a&&a.length>0){var b=a[0];f.priceGroups[b.$id].title=b.titleText}})}}})};f.editPriceItemDialog=function(h,i){var j=e("sm")||e("xs");f.selectedPriceItem=i;d.show({templateUrl:"app/components/administration/priceitems/priceitem.administration.modal.html",parent:angular.element(document.body),targetEvent:h,clickOutsideToClose:false,fullscreen:j,controller:b,controllerAs:"ctrl",locals:{$mdDialog:d,priceService:a,workTypesService:c,priceItem:f.selectedPriceItem}}).then(function(a){g()},function(){})};f.deletePriceItem=function(b,c){var e=d.confirm().title("Вы действительно хотите удалить?").textContent("Удаление услуги").ariaLabel("delete").targetEvent(b).ok("Удалить").cancel("Отменить");d.show(e).then(function(){a.deleteItem(c).then(function(a){g()})},function(){})};g();return f}function b(a,b,c,d){var e=this;e.selectedPriceItem=d;var f=function(){c.getDataAsync().then(function(a){e.workTypes=a})};e.hide=function(){a.hide()};e.cancel=function(){a.cancel()};e.saveItem=function(){b.savePriceItem(e.selectedPriceItem).then(function(b){a.hide()})};f();return e}})();(function(){angular.module("myApp").controller("worktypesAdministrationController",["$filter","$mdMedia","$mdDialog","workTypesService",a]);function a(a,c,d,e){var f=this;f.workTypes=[];f.baseWorkTypes=[];f.houseWorkTypes=[];var g=function(){e.getDataAsync().then(function(b){f.workTypes=b;f.baseWorkTypes=a("filter")(b,{categoryId:1},true);f.houseWorkTypes=a("filter")(b,{categoryId:2},true)})};f.editWorkTypeDialog=function(a,f){var h=c("sm")||c("xs");d.show({templateUrl:"app/components/administration/worktypes/worktype.administration.modal.html",parent:angular.element(document.body),targetEvent:a,clickOutsideToClose:false,fullscreen:h,controller:b,controllerAs:"ctrl",locals:{$mdDialog:d,workTypesService:e,workType:f}}).then(function(a){g()},function(){})};f.deleteWorkType=function(a,b){var c=d.confirm().title("Вы действительно хотите удалить?").textContent("Удаление услуги").ariaLabel("delete").targetEvent(a).ok("Удалить").cancel("Отменить");d.show(c).then(function(){e.deleteItem(b).then(function(a){g()})},function(){})};g();return f}function b(a,b,c){var d=this;d.selectedWorkType=c;d.saveItem=function(){b.saveItem(d.selectedWorkType).then(function(b){a.hide()})};d.hide=function(){a.hide()};d.cancel=function(){a.cancel()};return d}})();(function(){"use strict";angular.module("myApp").controller("feedbackController",["feedbackService","$mdDialog","$mdMedia",a]);function a(a,b,c){var d=this;d.feedbackList=a.feedbackList;d.addFeedback=function(a){var d=c("sm")||c("xs");b.show({templateUrl:"app/components/feedback/views/newfeedback.modal.html",parent:angular.element(document.body),targetEvent:a,clickOutsideToClose:true,fullscreen:d,controller:function(a,b){var c=this;c.newFeedback=new Object;c.hide=function(){b.hide()};c.cancel=function(){b.cancel()};c.saveFeedback=function(){if(c.newFeedback){a.saveFeedback(c.newFeedback)}};return c}}).then(function(a){},function(){})};return d}})();(function(){"use strict";angular.module("myApp").factory("feedbackService",function(){var a=this;a.feedbackList=[{id:1,date:Date.today(),name:"Имя",rating:5,text:"feedbackText"}];function b(a){if(a){}}return{saveFeedback:b,feedbackList:a.feedbackList}})})();(function(){"use strict";angular.module("myApp").controller("galleryController",["galleryService",a]);function a(a){var b=this;b.items=a.getData();$(".gallery-container").magnificPopup({delegate:"a",type:"image",gallery:{enabled:true,arrowMarkup:"",tCounter:'<span class="mfp-counter">%curr% из %total%</span>'}});return b}})();(function(){"use strict";var a="galleryService";angular.module("myApp").factory(a,["$q","$filter","$firebaseArray",function b(a,c,d){var e=this;e.photoList=[];function f(){var a=firebase.database().ref().child("PhotoList");e.photoList=d(a);return e.photoList}function g(){if(!e.photoList||!e.photoList.length){return d(firebase.database().ref().child("PhotoList")).$loaded().then(function(a){e.photoList=a;return e.photoList})}else{var b=a.defer();b.resolve(e.photoList);return b.promise}}function h(a){return g().then(function(b){return c("filter")(e.photoList,{workTypeId:a},true)})}function i(a){return g().then(function(b){if(!a.$id){b.$add(a)}else{var c=b.$indexFor(a.$id);if(c<0){b.$add(a)}else{b[c]=a;b.$save(c)}}})}function j(a){return g().then(function(b){var c=b.$indexFor(a.$id);if(c>0){b[c]=a;b.$remove(c)}})}return{getData:f,getDataAsync:g,getPhotoListByWorkTypeId:h,saveItem:i,deleteItem:j}}])})();(function(){"use strict";angular.module("myApp").controller("homeController",["$filter","homeService","workTypesService",a]);function a(a,b,c){var d=this;b.getInfoAsync().then(function(a){d.info=a});d.workTypes=[];d.baseWorkTypes=[];d.houseWorkTypes=[];var e=function(){c.getDataAsync().then(function(b){d.workTypes=b;d.baseWorkTypes=a("filter")(b,{categoryId:1},true);d.houseWorkTypes=a("filter")(b,{categoryId:2},true)})};e();return d}})();(function(){"use strict";angular.module("myApp").service("homeService",["$firebaseObject",function a(b){var c=this;function d(){return b(firebase.database().ref().child("About")).$loaded().then(function(a){c.data=a;return c.data})}function e(a){}return{getInfoAsync:d,saveInfo:e}}])})();(function(){"use strict";angular.module("myApp").controller("loginController",["$state","Authorization",a]);function a(a,b){var c=this;c.userName="";c.password="";c.messageText="";c.login=function(){if(c.userName=="admin"&&c.password=="admin"){b.go("administration")}else{c.messageText="Неправильный логин или пароль!"}};return c}})();(function(){"use strict";angular.module("myApp").controller("articlesController",["articleService",a]).directive("articlesPreview",b);function a(a){var b=this;b.postList=a.getArticles();return b}function b(){return{restrict:"E",templateUrl:"app/components/post/views/articles-preview.view.html"}}})();(function(){"use strict";var a="articleService";angular.module("myApp").factory(a,["$filter","$firebaseArray",function b(a,c){var d=this;var e={year:"numeric",month:"long",day:"numeric",weekday:"long"};d.preparedData=[];function f(){var a=firebase.database().ref().child("Articles");d.preparedData=c(a);d.preparedData.every(g);return d.preparedData}function g(a,b,c){a.formattedDate=a.date.toLocaleDateString("ru",e);return true}function h(b){if(!d.preparedData||!d.preparedData.length){f()}var c=parseInt(b);if(c){var e=a("filter")(d.preparedData,{id:c},true)}return e}function i(a){if(a){var b=h(a.id);if(!b){a.date=Date.today();console.log(a.date);a.formattedDate=a.date.toLocaleDateString("ru",e);d.preparedData.push(a)}else{b.title=a.title;b.previewText=a.previewText;b.text=a.text;b.date=a.date}}}function j(a){var b=h(a);if(b){var c=d.preparedData.map(function(a){return a.id}).indexOf(a);if(c>-1){d.preparedData.splice(c,1)}}}return{getArticles:f,getPost:h,savePost:i,deletePost:j}}])})();(function(){"use strict";angular.module("myApp").controller("postController",["articleService","$state","$stateParams",a]);function a(a,b,c){var d=this;var e=a.getPost(c.postId);if(e&&e.length){d.post=e[0]}else{b.go("404")}return d}})();(function(){"use strict";angular.module("myApp").controller("priceController",["priceService","workTypesService",a]);function a(a,b){var c=this;a.getDataAsync().then(function(a){c.priceGroups=_.groupBy(a,function(a){return a.workTypeId});for(var d in c.priceGroups){if(d=="-1"){c.priceGroups[d].title="Прочие услуги"}else{b.getTypeById(d).then(function(a){if(a&&a.length>0){var b=a[0];c.priceGroups[b.$id].title=b.titleText;c.priceGroups[b.$id].notesText=b.notesText}})}}});return c}})();(function(){"use strict";var a="priceService";angular.module("myApp").factory(a,["$q","$filter","$firebaseArray",function b(a,c,d){var e=this;e.priceItems=[];function f(){return d(firebase.database().ref().child("PriceItems")).$loaded().then(function(a){e.priceItems=a;return a})}function g(b){if(e.priceItems&&e.priceItems.length>0){var d=a.defer();var g=c("filter")(e.priceItems,{workTypeId:b},true);if(g&&g.length>0){d.resolve(g)}else{d.reject("work type not found")}return d.promise}else{return f().then(function(a){var d=c("filter")(e.priceItems,{workTypeId:b},true);return d})}}function h(a){return f().then(function(b){if(!a.$id){b.$add(a)}else{var c=b.$indexFor(a.$id);if(c<0){b.$add(a)}else{b[c]=a;b.$save(c)}}})}function i(a){return f().then(function(b){var c=b.$indexFor(a.$id);if(c>0){b[c]=a;b.$remove(c)}})}return{getDataAsync:f,getPriceItemsByWorkTypeId:g,savePriceItem:h,deleteItem:i}}])})();(function(){"use strict";angular.module("myApp").controller("requestController",a);function a(){var a=this;return a}})();(function(){"use strict";var a="requestService";angular.module("myApp").factory(a,["$filter",function b(a){var b=this;b.requestList=[{id:1,title:"Заявка 1",date:Date.today(),phone:"+375222242424",email:"email@mail.com",text:"Комментарии к заявке"},{id:2,title:"Заявка 2",date:Date.today(),phone:"+375222242424",email:"email@mail.com",text:"Комментарии к заявке"},{id:3,title:"Заявка 3",date:Date.today(),phone:"+375222242424",email:"email@mail.com",text:"Комментарии к заявке"},{id:4,title:"Заявка 4",date:Date.today(),phone:"+375222242424",email:"email@mail.com",text:"Комментарии к заявке"}];function c(a){if(a){b.requestList.push(a)}}function d(a){}return{requestList:b.requestList,saveRequest:c,deleteRequest:d}}])})();(function(){"use strict";angular.module("myApp").controller("workTypesHouseController",["$controller","$stateParams",a]);function a(a,b){var c=this;a("WorkTypesBaseController",{vm:c});c.getData(2,b.workTitle);return c}})();(function(){angular.module("myApp").controller("WorkTypesBaseController",["vm","workTypesService","priceService","galleryService","$filter",a]);function a(a,b,c,d,e){a.workTypes=[];a.getData=function(c,d){return b.getDataByCategoryId(c).then(function(b){a.workTypes=b;if(d){var c=e("filter")(a.workTypes,{urlText:d},true)[0];if(c){f(c);g()}}else{f(a.workTypes[0]);g()}})};function f(b){if(b){if(a.selectedItem){a.selectedItem.active=false}a.selectedItem=b;a.selectedItem.active=true}}function g(){a.selectedItem.priceItems=[];c.getPriceItemsByWorkTypeId(a.selectedItem.$id).then(function(b){a.selectedItem.priceItems=b});a.selectedItem.photos=[];d.getPhotoListByWorkTypeId(a.selectedItem.$id).then(function(b){a.selectedItem.photos=b})}a.initMagnific=function(){$(".gallery-photos").magnificPopup({delegate:"a",type:"image",gallery:{enabled:true,arrowMarkup:"",tCounter:'<span class="mfp-counter">%curr% из %total%</span>'}})}}})();(function(){"use strict";angular.module("myApp").controller("workTypesController",["$controller","$stateParams",a]);function a(a,b){var c=this;a("WorkTypesBaseController",{vm:c});c.getData(1,b.workTitle);return c}})();(function(){"use strict";var a="workTypesService";angular.module("myApp").factory(a,["_","$q","galleryService","$filter","$firebaseArray",function b(a,c,d,e,f){var g=this;g.data=[];function h(){return f(firebase.database().ref().child("WorkTypes")).$loaded().then(function(a){g.data=a;return g.data})}function i(a){return h().then(function(b){return e("filter")(g.data,{categoryId:a},true)})}function j(a){return h().then(function(b){return e("filter")(g.data,{$id:a},true)})}function k(a){return h().then(function(b){if(!a.$id){b.$add(a)}else{var c=b.$indexFor(a.$id);if(c<0){b.$add(a)}else{b[c]=a;b.$save(c)}}})}function l(a){return h().then(function(b){var c=b.$indexFor(a.$id);if(c>0){b[c]=a;b.$remove(c)}})}return{getDataAsync:h,getDataByCategoryId:i,getTypeById:j,saveItem:k,deleteItem:l}}])})();(function(){"use strict";angular.module("myApp").factory("Authorization",["$state",function(a){var b=this;function c(){return localStorage.authorizationToken==="password"}function d(){localStorage.authorizationToken=null}function e(b){localStorage.authorizationToken="password";a.go(b)}return{authorized:c,clear:d,go:e}}])})();$(document).ready(function(){$("a.on-top").click(function(a){$("html, body").animate({scrollTop:0},200);a.preventDefault()});$("a.bktop").click(function(a){$("html, body").animate({scrollTop:0},"1000");a.preventDefault()});$(window).scroll(function(){if($(this).scrollTop()>100){$(".bktop").fadeIn("2000")}else{$(".bktop").fadeOut("500")}})}).on("click",".navbar-collapse.in",function(a){if($(a.target).is("a")){$(this).collapse("hide")}});